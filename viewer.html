<html>
<head>
	<script src="./jquery-3.2.1.min.js"></script>
</head>
<body>
<canvas id="screen" width="800px" height="800px" style="border:1px solid #000000;">

</canvas>
<canvas id="screenH" width="800px" height="800px" style="border:1px solid #000000;">

</canvas>
<div id="debug">-</div>

<script type="text/javascript">
var canvas = document.getElementById("screen");
var canvasWidth = canvas.width;
var canvasHeight = canvas.height;
var ctx = canvas.getContext("2d");
ctx.fillStyle = '#000000';
ctx.fillRect(0, 0, canvasHeight, canvasWidth);
ctx.fillStyle = "#FF0000";
var canvasData = ctx.getImageData(0, 0, canvasWidth, canvasHeight);

var canvasH = document.getElementById("screenH");
var canvasHWidth = canvasH.width;
var canvasHHeight = canvasH.height;
var ctxH = canvasH.getContext("2d");
ctxH.fillStyle = '#000000';
ctxH.fillRect(0, 0, canvasHeight, canvasWidth);
ctxH.fillStyle = "#FF0000";
var canvasDataH = ctxH.getImageData(0, 0, canvasHWidth, canvasHHeight);
var galacticData;
var x;
var y;

getDataAndDraw();

// That's how you define the value of a pixel //
function drawPixel (x, y, r, g, b, a) {
    var index = (x + y * canvasWidth) * 4;

    canvasData.data[index + 0] = r;
    canvasData.data[index + 1] = g;
    canvasData.data[index + 2] = b;
    canvasData.data[index + 3] = a;
}
function drawPixelH (x, y, r, g, b, a) {
    var index = (x + y * canvasHWidth) * 4;

    canvasDataH.data[index + 0] = r;
    canvasDataH.data[index + 1] = g;
    canvasDataH.data[index + 2] = b;
    canvasDataH.data[index + 3] = a;
}

// That's how you update the canvas, so that your //
// modification are taken in consideration //
function updateCanvas() {
    ctx.putImageData(canvasData, 0, 0);
    ctxH.putImageData(canvasDataH, 0, 0);
}

function getGalacticData(offset=0){		
	$.ajax({
	    type: 'POST',
	    url: "http://localhost/perso/bigbang/viewer.php",
	    data: {'offset':offset},
	    
	    complete: function(data) {			   
		    if (data.responseText.trim() == ""){
		    	alert("vide");
			} else {
				galacticData=JSON.parse(data.responseText.trim());
				//document.getElementById('debug').innerHTML="response: "+data.responseText.trim();
			}					    
	    }
	  });
}

function getDataAndDraw(offset=1){	
	alert(offset);
	getGalacticData(offset);	
	for(var index in galacticData){
		var point=galacticData[index];
		//document.getElementById('debug').innerHTML=point['x']+" "+point['y']+" - ";
		drawPixel(point['x']+400, point['y']+400, 150, 130, 20, 250);
		drawPixelH(point['y']+400, point['z']+400, 150, 130, 20, 250);
		//ctx.fillRect(point['x']+350, point['y']+350,1,1);	
		
	}
	updateCanvas();
	if(offset<1000000){
		getDataAndDraw(offset+100000);
	}else{
		updateCanvas();
	}
}

</script>

</body>
</html>